University: [ITMO University](https://itmo.ru/ru/)
Faculty: [FICT](https://fict.itmo.ru)
Course: [Network programming](https://github.com/itmo-ict-faculty/network-programming)
Year: 2022/2023
Group: K34202
Author: Malyshev Alexey Andreevich
Lab: Lab4
Date of create: 20.12.2022
Date of finished: 26.12.2022

### I Подготовка
Склонирован репозиторий [p4lang/tutorials](https://github.com/p4lang/tutorials), установлен `Vagrant`, через него развернута виртуальная машина.
Рис1-2
> Заметка: На поднятой машине есть два аккаунта - p4 и vagrant, каждый из которых отвечает за работу соответствующего инструмента.

Перейдем к практической части лабораторной работы.

### II Implementing Basic Forwarding
Командами make build && make run (под учеткой p4) запущен `mininet`, а после проверена доступность узлов в нем.
Рис3

Изменен код в файле basic.p4:
1. В парсер добавлены заголовки ethernet_t, ipv4_t;
2. Изменена функция action ip4_forward: 
2.1 Определен выходной порт,
2.2 Обновлен адреса назначения и источника пакетов,
2.3 Изменено значение TTL;
3. Добавлена валидация заголовка ipv4.

Рис4-6

После проверена работа измененного скрипта.
Рис7
Все работает, настройка пересылок пакетов окончена, переходим к туннелированию.
### III - Implementing Basic Tunneling
После нужно было изменит код в basic_tunnel.p4:
1. В парсер добавлена функция реализующая заголовок туннеля; 
2. Добавлен action myTunnel_forward;
3. Добавлена таблица myTunnel_exact;
4. Добавлена функция определяющая необходимость применения myTunnel_exact, в зависимости от заголовка;
5. В Депарсер добавлена поддержка внесенных изменений.

Рис8-12

Снова проведена проверка доступности сети.
Рис13
И проверка работы скрипта о туннелировании.
Рис14

### IV Итоги
1. Схема сети mininet:
Рис15

2. Получен опыт работы с P4;
3. Выполнены несколько заданий из обуча.щего репозитория.